# 品質チェックフェーズ用プロンプト
# Agent 6-7のタスク定義

# ==========================
# Task 6: Quality Evaluation
# ==========================
tasks:
  quality_evaluation:
    description: |
      エンゲージメント最適化台本を8軸で厳格に評価し、WOWスコア8.0以上を保証してください。

      【評価対象台本】
      {{ optimized_script }}

      【8軸評価基準】（各10点満点）

      ## 1. 驚き度（Surprise Score）
      - 10点: 5箇所以上の「え!?」ポイント、意外性が非常に高い
      - 8点: 3-4箇所の驚きポイント、新しい発見がある
      - 6点: 1-2箇所の驚きポイント、やや予測可能
      - 4点以下: 驚きなし、既知の情報のみ

      **評価ポイント**:
      - Agent 1の驚きポイントが適切に挿入されているか
      - 数値インパクトが効果的に使われているか
      - 視聴者が「知らなかった！」と思えるか

      ## 2. 感動度（Emotion Score）
      - 10点: 視聴者が共感し行動を起こしたくなる、心に残る
      - 8点: 感情移入できるエピソードあり、感動的
      - 6点: 感情要素はあるがデータ中心
      - 4点以下: データのみで感情なし

      **評価ポイント**:
      - ストーリーアークが機能しているか
      - 感情ピークが5箇所配置されているか
      - 具体例が視聴者の共感を呼ぶか

      ## 3. 明瞭度（Clarity Score）
      - 10点: 専門用語すべてに説明あり、非常にわかりやすい
      - 8点: 主要な専門用語に説明あり、理解しやすい
      - 6点: 一部専門用語の説明不足
      - 4点以下: 専門用語だらけで理解困難

      **評価ポイント**:
      - 専門用語の日本語化・説明が適切か
      - 一文15文字以内のルールが守られているか
      - 話の流れが論理的か

      ## 4. 保持率予測（Retention Prediction）
      - 10点: 予測平均55%+、トップクラス
      - 8点: 予測平均50-54%、優秀
      - 6点: 予測平均45-49%、標準以上
      - 4点以下: 予測平均45%未満、改善必要

      **評価ポイント**:
      - Agent 5の保持率予測データを参照
      - 最初の8秒で引き込めているか
      - 30秒ごとのパターン・インタラプトがあるか

      ## 5. 行動喚起（Action Score）
      - 10点: 明確な行動指針、視聴後すぐ実行できる
      - 8点: 行動指針あり、実行可能
      - 6点: 示唆のみ、具体的行動なし
      - 4点以下: 行動喚起なし

      **評価ポイント**:
      - 「あなたが明日からできること」が示されているか
      - 具体的で実行可能か
      - CTA（チャンネル登録など）があるか

      ## 6. データ裏付け（Evidence Score）
      - 10点: 具体的数値10箇所以上、出典明記
      - 8点: 具体的数値7-9箇所、裏付け十分
      - 6点: 具体的数値4-6箇所、やや不足
      - 4点以下: 数値3箇所以下、根拠薄弱

      **評価ポイント**:
      - 具体的数値が10箇所以上あるか
      - 出典が適切に言及されているか
      - 比較対象が明確か

      ## 7. 日本語純度（Japanese Purity）
      - 10点: 英語混入0、完璧な日本語
      - 8点: 許可される略語のみ（AI/GDP/IT）
      - 6点: 一部英語混入、カタカナ多用
      - 4点以下: 英語多数、視聴者が理解困難

      **評価ポイント**:
      - 英語単語の有無（AI/GDP/IT以外）
      - カタカナの過度な使用
      - 話し言葉の自然さ

      ## 8. 視覚設計（Visual Design）
      - 10点: 視覚指示20箇所以上、完璧な設計
      - 8点: 視覚指示15-19箇所、十分
      - 6点: 視覚指示10-14箇所、やや不足
      - 4点以下: 視覚指示10箇所未満、不十分

      **評価ポイント**:
      - (字幕: XX)、(グラフ: YY)などの指示があるか
      - 30秒ごとに視覚変化があるか
      - 適切なタイミングで配置されているか

      【総合WOWスコア算出】
      WOWスコア = (驚き度 × 0.25) + (感動度 × 0.20) + (明瞭度 × 0.15) +
                  (保持率予測/10 × 0.15) + (行動喚起 × 0.10) +
                  (データ裏付け × 0.10) + (日本語純度/10 × 0.05)

      【判定基準】
      - WOWスコア 8.0以上: ✅ 合格 → Agent 7へ
      - WOWスコア 7.0-7.9: ⚠️ 要改善 → Agent 5で微調整
      - WOWスコア 7.0未満: ❌ 不合格 → Agent 4に差し戻し（最大2回）

      【出力形式】（JSON）
      ```json
      {
        "wow_score": 8.5,
        "dimension_scores": {
          "surprise": 9.0,
          "emotion": 8.5,
          "clarity": 8.0,
          "retention_prediction": 54.0,
          "action": 8.5,
          "evidence": 9.0,
          "japanese_purity": 96.0,
          "visual_design": 9.0
        },
        "is_passing": true,
        "quality_level": "excellent",
        "strengths": [
          "驚きポイントが5箇所あり、非常に効果的",
          "ストーリーアークが機能し、感情移入できる",
          "具体的数値が12箇所あり、説得力が高い"
        ],
        "improvements": [
          "2:30-3:00区間に追加の驚きポイントを挿入",
          "専門用語「量的緩和」を「お金を増やす政策」に言い換え"
        ],
        "critical_issues": [],
        "recommendation": "合格。Agent 7（日本語純度向上）へ進む"
      }
      ```

    expected_output: |
      品質評価レポート（8軸スコア + WOWスコア + 改善指示）のJSON

  # ==========================
  # Task 7: Japanese Purity Check
  # ==========================
  japanese_purity_check:
    description: |
      最終台本の日本語純度チェック＆仕上げを行い、95点以上を保証してください。

      【評価済み台本】
      {{ quality_approved_script }}

      【品質評価結果】
      {{ quality_evaluation_result }}

      【チェック項目】

      ## 1. 英語単語の検出と置換
      **許可される語彙**: AI, GDP, IT, IoT, DX
      **NG**: その他すべての英単語

      検出例:
      - "impact" → "影響"
      - "trend" → "傾向"
      - "risk" → "リスク"（許可）
      - "data" → "データ"（許可）

      ## 2. 専門用語の日本語化
      - "QE" → "量的緩和"
      - "Fed" → "米連邦準備制度理事会"
      - "FOMC" → "連邦公開市場委員会"
      - "ETF" → "上場投資信託"

      ## 3. カタカナの最小化
      **OK**: データ、リスク、グラフ、パーセント
      **NG→変換**:
      - インパクト → 影響
      - トレンド → 傾向
      - ポイント → 点、要点
      - ケース → 場合

      ## 4. 話し言葉の自然さ
      - 硬すぎる表現を柔らかく
      - 「である」→「です」
      - 「したがって」→「ですから」
      - 「〜と考えられる」→「〜と思われます」

      ## 5. TTS最適化
      読み間違えやすい漢字にルビ指示:
      - 「為替(かわせ)」
      - 「寡占(かせん)」
      - 「債券(さいけん)」

      【合格基準】
      - 日本語純度スコア: 95点以上
      - 英語混入: 0箇所（許可語彙除く）
      - 自然さスコア: 8/10以上

      【最終仕上げ】
      - 話者名の統一確認（田中: 鈴木: ナレーター:）
      - final_scriptは必ず「話者名: セリフ」の形式で記述してください。
      - 視覚指示の形式統一
      - 文字数の最終調整（目標±5%以内）

      最終出力は、必ず指定されたJSON形式で、Markdownのコードブロック（```json ... ```）で囲んでください。

      【出力形式】（JSON）
      ```json
      {
        "final_script": "日本語純度100%の最終完成台本",
        "japanese_purity_score": 97.5,
        "issues_fixed": [
          "「impact」を「影響」に変更（3箇所）",
          "「trend」を「傾向」に変更（2箇所）",
          "「QE」を「量的緩和」に置換（1箇所）"
        ],
        "character_count": 2420,
        "visual_instructions_count": 18,
        "quality_guarantee": {
          "wow_score": 8.5,
          "japanese_purity": 97.5,
          "retention_prediction": 54.0,
          "surprise_points": 6,
          "emotion_peaks": 5,
          "concrete_numbers": 12
        },
        "certification": "✅ WOW Script Creation Crew認定：視聴者満足度保証"
      }
      ```

    expected_output: |
      最終完成台本 + 日本語純度スコア + 品質保証データ（JSON）

