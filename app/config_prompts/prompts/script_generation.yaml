# 台本生成フェーズ用プロンプト
# Agent 4-5のタスク定義

# ==========================
# Task 4: Script Writing
# ==========================
tasks:
  script_writing:
    description: |
      これまでの全分析結果を統合し、対談形式の台本初稿を執筆してください。

      【統合する要素】
      - Agent 1の「驚きポイント」: {{ surprise_points }}
      - Agent 2の「好奇心ギャップ」: {{ curiosity_gaps }}
      - Agent 3の「ストーリーアーク」: {{ story_arc }}

      {% if continuity_prompt %}
      【前回動画とのつながり方針】
      {{ continuity_prompt }}
      {% endif %}

      {% if agent_improvement_notes %}
      【今回の改善フォーカス】
      {{ agent_improvement_notes }}
      {% endif %}

      【2025年YouTube最適化ルール】

      ## 最初の8秒ルール（超重要）
      0:00-0:08 → 結論 + 驚きの数値 + 疑問提示

      例:
      ```
      田中: 「今回の日銀決定で、あなたの資産が10%変動する可能性があります」
      (字幕: 10%変動!?)
      鈴木: 「え、なぜですか!?」
      ```

      ## パターン・インタラプト（30秒ごと）
      - 0:30 → グラフ表示
      - 1:00 → 驚きの事実
      - 1:30 → 視聴者への質問
      - 2:00 → 実例紹介
      （以降30秒ごと継続）

      ## 会話リズム
      - 田中: 3文説明 → 鈴木: 1文質問/リアクション
      - 一文15文字以内（TTS最適化）
      - 専門用語は即座に日本語で言い換え

      ## 視覚指示（15箇所以上）
      - (字幕: XX%) → 数値強調
      - (グラフ: YY推移) → データ可視化
      - (比較表: before/after) → 対比表示
      - (強調: 重要ポイント) → ハイライト

      ## PREP法（3箇所以上使用）
      Point（結論） → Reason（理由） → Example（具体例） → Point（再結論）

      【台本構成】（8分 = 2,400文字±200）

      ```
      ## オープニング (0:00-0:30, 150文字)

      ナレーター: 「こんにちは。今回は[話題の核心]について解説します」

      田中: 「結論から言うと、[明確な結論]です」
      (字幕: [重要数値])

      鈴木: 「え、それって[視聴者の疑問]ってことですか？」

      田中: 「その通りです。詳しく見ていきましょう」

      ---

      ## 本編1: 第一要因の分析 (0:30-2:30, 600文字)

      [ストーリーアークのセクション2-3を展開]
      [好奇心ギャップ1を配置]
      [驚きポイント1-2を挿入]
      [PREP法を1回使用]

      ---

      ## 本編2: 第二要因の分析 (2:30-4:30, 600文字)

      [ストーリーアークのセクション4を展開]
      [好奇心ギャップ2を配置]
      [驚きポイント3-4を挿入]
      [PREP法を1回使用]

      ---

      ## 本編3: リスクと注意点 (4:30-6:30, 600文字)

      [ストーリーアークのセクション5を展開]
      [好奇心ギャップ3の完全な答え明かし]
      [驚きポイント5を挿入]
      [PREP法を1回使用]

      ---

      ## まとめ (6:30-7:30, 300文字)

      [ストーリーアークのセクション6を展開]

      ナレーター: 「今回のポイントを3つにまとめます」
      ナレーター: 「1つ目、[要因1のまとめ]」
      ナレーター: 「2つ目、[要因2のまとめ]」
      ナレーター: 「3つ目、[リスク要因のまとめ]」
      ナレーター: 「これらを踏まえて[最終的な示唆]」

      ---

      ## エンディング (7:30-8:00, 150文字)

      ナレーター: 「今回の動画が参考になったら」
      ナレーター: 「チャンネル登録と高評価をお願いします」
      ナレーター: 「コメント欄でご意見もお待ちしています」
      ```

      【品質チェックリスト】
      ☐ 一文15文字以内を遵守
      ☐ 数値に(字幕: XX)指示を付与
      ☐ グラフに(グラフ: YY)指示を付与
      ☐ 田中3文→鈴木1文のリズム維持
      ☐ PREP法を3箇所以上で使用
      ☐ 総文字数2,400文字程度
      ☐ 視聴者目線の疑問を3回以上
      ☐ 具体的数値を10箇所以上
      ☐ リスク分析を必ず含む
      ☐ 最終的な行動示唆を提示

      【言語に関する重要指示】
      - すべて純粋な日本語で記述
      - 英語の単語や表現を使用しない
      - 専門用語は理解しやすい日本語で説明
      - AI、GDP、ITなどの一般的な略語のみ使用可能

    expected_output: |
      対談形式の台本初稿（2,400文字±200、視覚指示15箇所以上含む）

  # ==========================
  # Task 5: Engagement Optimization
  # ==========================
  engagement_optimization:
    description: |
      初稿台本を分析し、エンゲージメント要素を追加挿入して保持率50%+を目指してください。

      【初稿台本】
      {{ first_draft_script }}

      {% if continuity_prompt %}
      【継続視聴を促すリマインダー】
      {{ continuity_prompt }}
      {% endif %}

      {% if agent_improvement_notes %}
      【今回の改善フォーカス】
      {{ agent_improvement_notes }}
      {% endif %}

      【追加するエンゲージメント要素】

      ## 1. オープンループ（未解決の疑問）
      挿入位置: 1:00, 3:00, 5:00
      例: 「この理由は後ほど明かします」
      効果: 視聴者を引き留める

      ## 2. 視聴者参加型要素
      挿入位置: 2:30, 5:30
      例: 「あなたならどちらを選びますか？コメント欄で教えてください」
      効果: エンゲージメント率+12%

      ## 3. 未来予測フック
      挿入位置: 4:00
      例: 「今後30日以内に〇〇が起きる可能性があります」
      効果: 緊急性の演出

      ## 4. パターン・インタラプト強化
      - 音声変化: 鈴木の「え！」「マジですか!?」
      - トーン変化: 田中の一時停止「...実は」
      - 数値インパクト: 「なんと500%増」

      ## 5. ソーシャルプルーフ
      挿入位置: 3:30, 6:00
      例: 「専門家100人に調査した結果」
      例: 「過去10年で最大規模」

      【保持率予測】
      各30秒区間ごとに予測保持率を算出:
      - 0-30秒: 目標 80%+
      - 30-60秒: 目標 70%+
      - 1-2分: 目標 60%+
      - 2-4分: 目標 50%+
      - 4-8分: 目標 45%+

      予測が目標未達のセクションに追加要素を挿入

      【出力形式】
      ```
      {
        "optimized_script": "エンゲージメント最適化後の台本全文",
        "retention_prediction": {
          "0-30s": 82,
          "30-60s": 73,
          "60-120s": 61,
          "120-240s": 52,
          "240-480s": 47,
          "overall_avg": 54
        },
        "improvements_made": [
          "1:15に未来予測フック追加",
          "3:00に視聴者質問追加",
          "5:30にソーシャルプルーフ追加"
        ],
        "engagement_elements_added": {
          "open_loops": 3,
          "viewer_participation": 2,
          "future_predictions": 2,
          "social_proof": 2,
          "pattern_interrupts": 16
        }
      }
      ```

    expected_output: |
      エンゲージメント最適化台本 + 保持率予測データ + 改善リスト（JSON）
